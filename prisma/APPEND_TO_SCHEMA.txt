
model TierChange {
  id           String         @id @default(cuid())
  memberId     String
  member       Member         @relation(fields: [memberId], references: [id], onDelete: Cascade)
  fromCategory MemberCategory
  toCategory   MemberCategory
  reason       String
  changedBy    String
  tenantId     String
  createdAt    DateTime       @default(now())

  @@index([memberId])
  @@index([tenantId])
  @@index([createdAt])
}

model GeneratedReport {
  id          String   @id @default(cuid())
  tenantId    String
  tenant      Tenant   @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  
  reportType  String   // "WEEKLY_EXECUTIVE", "MONTHLY_SUMMARY"
  period      String   // "2026-W07" (ISO week), "2026-02" (month)
  
  // Snapshot of key metrics at generation time
  metricsSnapshot Json  // Stores all dashboard metrics
  
  generatedAt DateTime @default(now())
  sentTo      String?  // Email where it was sent
  sentAt      DateTime?
  deliveryStatus String @default("PENDING") // PENDING, SENT, FAILED
  
  // Security: Secure download links
  downloadToken String? @unique // For secure downloads
  tokenExpiry   DateTime?       // 24h expiration
  
  @@index([tenantId])
  @@index([period])
  @@index([downloadToken])
  @@index([createdAt])
  @@index([deliveryStatus])
}
